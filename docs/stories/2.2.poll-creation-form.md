# Story 2.2: Poll Creation Form

## Status
Ready for Development

## Story
**As a** user,
**I want** to create a poll with two images and optional details,
**so that** I can share my decision dilemma with friends.

## Acceptance Criteria
1. Poll creation form is created with two image upload fields
2. Optional label fields are provided for each image option
3. Optional description field is available for poll context
4. Form validation is implemented for required fields
5. Mobile-optimized interface with large touch targets
6. Form submission creates poll record in database
7. Success confirmation and redirect to poll view page

## Tasks / Subtasks
- [ ] Task 1: Create Poll Creation Form Component (AC: 1, 2, 3, 5)
  - [ ] Build form component with two image upload fields
  - [ ] Add optional label inputs for each image option
  - [ ] Implement optional description textarea
  - [ ] Design mobile-optimized layout with large touch targets
- [ ] Task 2: Implement Form Validation (AC: 4)
  - [ ] Add client-side validation for required fields
  - [ ] Implement server-side validation for data integrity
  - [ ] Create user-friendly error messages
  - [ ] Add real-time validation feedback
- [ ] Task 3: Database Integration (AC: 6)
  - [ ] Create poll record in database with form data
  - [ ] Link uploaded images to poll record
  - [ ] Set poll expiration to 24 hours from creation
  - [ ] Handle form submission errors gracefully
- [ ] Task 4: Success Flow (AC: 7)
  - [ ] Implement success confirmation message
  - [ ] Redirect to poll view page after creation
  - [ ] Generate unique poll URL for sharing
  - [ ] Add loading states during submission
- [ ] Task 5: Testing (AC: All)
  - [ ] Test form validation with various inputs
  - [ ] Test mobile form interaction
  - [ ] Test database integration and error handling
  - [ ] Test success flow and redirects

## Dev Notes

### Previous Story Insights
This story builds on Story 2.1 (Image Upload System) which established the image upload functionality. The poll creation form will integrate with the existing `ImageUpload` components and follow the mobile-first design patterns established in previous stories.

### Technology Stack
[Source: architecture.md#tech-stack]
- **Form Handling**: React Hook Form with validation
- **UI Components**: Shadcn/ui Form components from Story 1.4
- **Database**: Supabase with existing polls table
- **Image Integration**: Supabase Storage from Story 2.1
- **Mobile Design**: Tailwind CSS with mobile-first approach

### Integration Points
[Source: architecture.md#unified-project-structure]
- **Image Upload**: Uses `ImageUpload` components from Story 2.1
- **Database**: Integrates with existing Supabase polls table
- **Authentication**: Leverages AuthContext from Story 1.3
- **UI Components**: Uses Form, Button, Card components from Story 1.4
- **Mobile Design**: Follows mobile-first patterns from Story 1.4

### File Structure
[Source: architecture.md#unified-project-structure]
```
src/
├── components/
│   ├── poll/
│   │   ├── PollCreationForm.tsx
│   │   └── PollFormFields.tsx
│   └── upload/
│       └── (existing ImageUpload components)
├── lib/
│   ├── services/
│   │   └── polls.ts (existing)
│   └── validation/
│       └── poll-validation.ts
└── app/
    └── (main)/
        └── poll/
            └── create/
                └── page.tsx (existing)
```

### Technical Implementation
[Source: technical-specifications.md#poll-creation-form]

#### Form Component Structure
```typescript
// components/poll/PollCreationForm.tsx
interface PollFormData {
  imageA: File | null;
  imageB: File | null;
  labelA: string;
  labelB: string;
  description: string;
}

export default function PollCreationForm() {
  // Form implementation with validation
}
```

#### Database Schema Integration
```typescript
// lib/services/polls.ts (existing)
export const createPoll = async (pollData: CreatePollData): Promise<Poll> => {
  const supabase = createClient();
  const { data, error } = await supabase
    .from('polls')
    .insert({
      creator_id: pollData.creatorId,
      image_a_url: pollData.imageAUrl,
      image_b_url: pollData.imageBUrl,
      label_a: pollData.labelA,
      label_b: pollData.labelB,
      description: pollData.description,
      expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000)
    })
    .select()
    .single();
    
  if (error) throw error;
  return data;
};
```

#### Form Validation
```typescript
// lib/validation/poll-validation.ts
export const validatePollForm = (data: PollFormData): ValidationResult => {
  const errors: string[] = [];
  
  if (!data.imageA) errors.push('Image A is required');
  if (!data.imageB) errors.push('Image B is required');
  if (data.labelA.length > 50) errors.push('Label A must be 50 characters or less');
  if (data.labelB.length > 50) errors.push('Label B must be 50 characters or less');
  if (data.description.length > 500) errors.push('Description must be 500 characters or less');
  
  return {
    valid: errors.length === 0,
    errors
  };
};
```

### File Locations
[Source: architecture.md#unified-project-structure]
- **Form Components**: `apps/web/src/components/poll/`
- **Validation Logic**: `apps/web/src/lib/validation/`
- **Poll Creation Page**: `apps/web/src/app/(main)/poll/create/page.tsx`
- **Database Services**: `apps/web/src/lib/services/polls.ts`

### Technical Constraints
[Source: architecture.md#technical-assumptions]
- **Form Validation**: Client-side and server-side validation required
- **Mobile Optimization**: Large touch targets (minimum 44px)
- **Database**: Must integrate with existing polls table schema
- **Image Integration**: Must work with existing ImageUpload components
- **Accessibility**: WCAG AA compliance for form elements
- **Performance**: Form submission under 2 seconds on mobile

### Testing
[Source: architecture.md#testing-strategy]

#### Testing Standards
- **Test File Location**: `apps/web/tests/unit/` for unit tests
- **Testing Framework**: Vitest + React Testing Library for component testing
- **Test Standards**: 
  - Unit tests for form components and validation
  - Integration tests for database operations
  - E2E tests for complete form submission flow
- **Testing Requirements for this Story**:
  - Test form validation with various inputs
  - Test mobile form interaction and touch targets
  - Test database integration and error handling
  - Test success flow and redirects

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation using BMAD workflow | Product Manager |

## Dev Agent Record

### Agent Model Used
*To be populated by Dev Agent*

### Debug Log References
*To be populated by Dev Agent*

### Completion Notes List
*To be populated by Dev Agent*

### File List

**New Files:**
*To be populated by Dev Agent*

**Modified Files:**
*To be populated by Dev Agent*

**Database Migrations:**
*To be populated by Dev Agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
