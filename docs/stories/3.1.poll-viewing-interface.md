# Story 3.1: Poll Viewing Interface

## Status
Ready for Development

## Story
**As Mike (friend/voter),**
I want to see a poll clearly on my phone,
so that I can easily understand what I'm voting on.

## Acceptance Criteria
1. I can see both images side by side on my phone screen
2. Option labels are clearly displayed with the images
3. The poll description is shown if available
4. I can see how much time is left to vote
5. The voting buttons are large and easy to tap
6. The poll status (Active/Closed) is clearly shown
7. The page loads quickly on my mobile browser

## Tasks / Subtasks
- [ ] Task 1: Poll View Page Layout (AC: 1, 2, 3, 6)
  - [ ] Create poll view page with responsive layout
  - [ ] Display both images side by side on mobile
  - [ ] Show option labels clearly with images
  - [ ] Display poll description when available
  - [ ] Show poll status badge prominently
- [ ] Task 2: Voting Interface (AC: 5)
  - [ ] Create large, touch-friendly voting buttons
  - [ ] Implement vote submission functionality
  - [ ] Add vote confirmation feedback
  - [ ] Handle voting errors gracefully
- [ ] Task 3: Poll Information Display (AC: 4, 7)
  - [ ] Show countdown timer for active polls
  - [ ] Display poll creation time and expiration
  - [ ] Add loading states for fast perceived performance
  - [ ] Optimize page load speed for mobile
- [ ] Task 4: Poll State Management (AC: 6)
  - [ ] Handle active vs closed poll states
  - [ ] Show appropriate UI for each state
  - [ ] Prevent voting on closed polls
  - [ ] Display final results for closed polls
- [ ] Task 5: Testing (AC: All)
  - [ ] Test poll viewing on various mobile devices
  - [ ] Test voting functionality and error handling
  - [ ] Test poll state transitions
  - [ ] Test performance and loading times

## Dev Notes

### Previous Story Insights
This story builds on Story 2.4 (Poll Management Interface) which established poll display components and status management. The poll viewing interface will integrate with the existing poll status system and provide a clean, mobile-optimized interface for voters.

### Technology Stack
[Source: architecture.md#tech-stack]
- **Database**: Supabase with existing polls and votes tables
- **Real-time**: Supabase Realtime for live updates
- **UI Components**: Shadcn/ui components for poll display
- **Mobile Design**: Tailwind CSS with mobile-first approach
- **Performance**: Next.js optimization for fast loading

### Integration Points
[Source: architecture.md#unified-project-structure]
- **Database**: Queries existing polls table with vote counts
- **Poll Status**: Integrates with status system from Story 2.3
- **UI Components**: Uses existing components from Story 1.4
- **Real-time Updates**: Leverages Supabase Realtime for live data
- **Voting System**: Prepares for Story 3.2 (Binary Voting System)

### File Structure
[Source: architecture.md#unified-project-structure]
```
src/
├── components/
│   ├── poll/
│   │   ├── PollView.tsx
│   │   ├── PollImages.tsx
│   │   ├── PollVoting.tsx
│   │   └── PollResults.tsx
│   └── ui/
│       └── (existing components)
├── lib/
│   ├── services/
│   │   ├── polls.ts (existing, updated)
│   │   └── votes.ts
│   └── hooks/
│       └── usePoll.ts
└── app/
    └── (main)/
        └── poll/
            └── [id]/
                └── page.tsx
```

### Technical Implementation
[Source: technical-specifications.md#poll-viewing-interface]

#### Poll View Page Component
```typescript
// app/(main)/poll/[id]/page.tsx
import { notFound } from 'next/navigation';
import PollView from '@/components/poll/PollView';
import { PollsService } from '@/lib/services/polls';

interface PollPageProps {
  params: { id: string };
}

export default async function PollPage({ params }: PollPageProps) {
  const poll = await PollsService.getPollById(params.id);
  
  if (!poll) {
    notFound();
  }
  
  return <PollView poll={poll} />;
}
```

#### Poll View Component
```typescript
// components/poll/PollView.tsx
interface PollViewProps {
  poll: PollWithResults;
}

export default function PollView({ poll }: PollViewProps) {
  const pollStatus = getPollStatus(poll);
  
  return (
    <div className="min-h-screen bg-background">
      <div className="container mx-auto px-4 py-6 max-w-2xl">
        {/* Poll Header */}
        <div className="mb-6">
          <div className="flex items-center justify-between mb-4">
            <PollStatusBadge status={pollStatus} />
            {pollStatus === 'active' && (
              <CountdownTimer expiresAt={poll.expires_at} />
            )}
          </div>
          
          {poll.description && (
            <p className="text-lg text-muted-foreground">
              {poll.description}
            </p>
          )}
        </div>
        
        {/* Poll Images */}
        <PollImages poll={poll} />
        
        {/* Voting Interface or Results */}
        {pollStatus === 'active' ? (
          <PollVoting poll={poll} />
        ) : (
          <PollResults poll={poll} />
        )}
      </div>
    </div>
  );
}
```

#### Poll Images Component
```typescript
// components/poll/PollImages.tsx
interface PollImagesProps {
  poll: PollWithResults;
}

export default function PollImages({ poll }: PollImagesProps) {
  return (
    <div className="grid grid-cols-2 gap-4 mb-6">
      <div className="text-center">
        <div className="relative mb-2">
          <img
            src={poll.option_a_image_url}
            alt={poll.option_a_label || 'Option A'}
            className="w-full h-48 object-cover rounded-lg border"
          />
        </div>
        <h3 className="font-semibold text-lg">
          {poll.option_a_label || 'Option A'}
        </h3>
      </div>
      
      <div className="text-center">
        <div className="relative mb-2">
          <img
            src={poll.option_b_image_url}
            alt={poll.option_b_label || 'Option B'}
            className="w-full h-48 object-cover rounded-lg border"
          />
        </div>
        <h3 className="font-semibold text-lg">
          {poll.option_b_label || 'Option B'}
        </h3>
      </div>
    </div>
  );
}
```

#### Poll Voting Component
```typescript
// components/poll/PollVoting.tsx
interface PollVotingProps {
  poll: PollWithResults;
}

export default function PollVoting({ poll }: PollVotingProps) {
  const [hasVoted, setHasVoted] = useState(!!poll.user_vote);
  const [isVoting, setIsVoting] = useState(false);
  
  const handleVote = async (choice: 'option_a' | 'option_b') => {
    if (hasVoted || isVoting) return;
    
    setIsVoting(true);
    try {
      await VotesService.submitVote(poll.id, choice);
      setHasVoted(true);
    } catch (error) {
      console.error('Vote failed:', error);
    } finally {
      setIsVoting(false);
    }
  };
  
  if (hasVoted) {
    return <PollResults poll={poll} />;
  }
  
  return (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold text-center">
        Which do you prefer?
      </h2>
      
      <div className="grid grid-cols-2 gap-4">
        <Button
          size="lg"
          onClick={() => handleVote('option_a')}
          disabled={isVoting}
          className="h-16 text-lg"
        >
          {poll.option_a_label || 'Option A'}
        </Button>
        
        <Button
          size="lg"
          variant="outline"
          onClick={() => handleVote('option_b')}
          disabled={isVoting}
          className="h-16 text-lg"
        >
          {poll.option_b_label || 'Option B'}
        </Button>
      </div>
      
      {isVoting && (
        <p className="text-center text-muted-foreground">
          Submitting your vote...
        </p>
      )}
    </div>
  );
}
```

### File Locations
[Source: architecture.md#unified-project-structure]
- **Poll View Page**: `apps/web/src/app/(main)/poll/[id]/page.tsx`
- **Poll Components**: `apps/web/src/components/poll/`
- **Voting Service**: `apps/web/src/lib/services/votes.ts`
- **Poll Hook**: `apps/web/src/lib/hooks/usePoll.ts`

### Technical Constraints
[Source: architecture.md#technical-assumptions]
- **Mobile-First**: Optimized for mobile viewing and interaction
- **Performance**: Page loads in <2 seconds on mobile 3G
- **Accessibility**: WCAG AA compliance for voting interface
- **Real-time**: Live updates for vote counts and poll status
- **Anonymous Voting**: Support for unauthenticated users
- **Vote Prevention**: Prevent duplicate voting from same user

### Testing
[Source: architecture.md#testing-strategy]

#### Testing Standards
- **Test File Location**: `apps/web/tests/unit/` for unit tests
- **Testing Framework**: Vitest + React Testing Library for component testing
- **Test Standards**: 
  - Unit tests for poll viewing components
  - Integration tests for voting functionality
  - E2E tests for complete poll viewing flow
- **Testing Requirements for this Story**:
  - Test poll viewing on various screen sizes
  - Test voting functionality and state management
  - Test poll status transitions and error handling
  - Test performance and loading optimization

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation using BMAD workflow | Product Manager |

## Dev Agent Record

### Agent Model Used
*To be populated by Dev Agent*

### Debug Log References
*To be populated by Dev Agent*

### Completion Notes List
*To be populated by Dev Agent*

### File List

**New Files:**
*To be populated by Dev Agent*

**Modified Files:**
*To be populated by Dev Agent*

**Database Migrations:**
*To be populated by Dev Agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
